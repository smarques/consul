// Generated by CoffeeScript 1.12.6
(function() {
  "use strict";
  App.MarkdownEditor = {
    refresh_preview: function(element, md) {
      var result, textarea_content;
      textarea_content = App.MarkdownEditor.find_textarea(element).val();
      result = md.render(textarea_content);
      return element.find(".markdown-preview").html(result);
    },
    // Multi-locale (translatable) form fields work by hiding inputs of locales
    // which are not "active".
    find_textarea: function(editor) {
      return editor.find("textarea");
    },
    initialize: function() {
      return $(".markdown-editor").each(function() {
        var editor, md;
        md = window.markdownit({
          html: true,
          breaks: true,
          typographer: true
        });
        editor = $(this);
        editor.on("input", function() {
          App.MarkdownEditor.refresh_preview($(this), md);
          $(".legislation-draft-versions-edit .warning").show();
        });
        editor.find("textarea").on("scroll", function() {
          return editor.find(".markdown-preview").scrollTop($(this).scrollTop());
        });
        return editor.find(".fullscreen-toggle").on("click", function() {
          var span;
          editor.toggleClass("fullscreen");
          $(".fullscreen-container").toggleClass("medium-8", "medium-12");
          span = $(this).find("span");
          if (span.html() === span.data("open-text")) {
            span.html(span.data("closed-text"));
          } else {
            span.html(span.data("open-text"));
          }
          if (editor.hasClass("fullscreen")) {
            App.MarkdownEditor.find_textarea(editor).height($(window).height() - 100);
            return App.MarkdownEditor.refresh_preview(editor, md);
          } else {
            return App.MarkdownEditor.find_textarea(editor).height("10em");
          }
        });
      });
    }
  };

}).call(this);
